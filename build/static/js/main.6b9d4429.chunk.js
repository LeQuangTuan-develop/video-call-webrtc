(this.webpackJsonpwebrtc=this.webpackJsonpwebrtc||[]).push([[0],{34:function(e,t,n){e.exports=n(71)},39:function(e,t,n){},40:function(e,t,n){},68:function(e,t){},71:function(e,t,n){"use strict";n.r(t);var o=n(0),c=n.n(o),a=n(26),r=n.n(a),s=(n(39),n(27)),l=n(28),i=n(29),u=n(32),d=n(30),f=n(33),m=(n(40),n(31)),p=n.n(m),g={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.services.mozilla.com"]},{urls:["stun:ss-turn2.xirsys.com"]},{username:"SL5X7cJw92B3v3X50Py-NYN6xdo9j7CXriaUuC52i0yqjx0i5i6JpvXDH5Ux2uoBAAAAAGFCpbdRdWFuZ1R1YW4xNjU=",credential:"272d8792-1692-11ec-897d-0242ac140004",urls:["turn:ss-turn2.xirsys.com:80?transport=udp","turn:ss-turn2.xirsys.com:3478?transport=udp","turn:ss-turn2.xirsys.com:80?transport=tcp","turn:ss-turn2.xirsys.com:3478?transport=tcp","turns:ss-turn2.xirsys.com:443?transport=tcp","turns:ss-turn2.xirsys.com:5349?transport=tcp"]}]};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).componentDidMount=function(){n.socket=p.a.connect("/webrtcPeer",{path:"/io/webrtc",query:{}}),n.socket.on("connection-success",(function(e){console.log("K\u1ebft n\u1ed1i th\xe0nh c\xf4ng",e)})),n.socket.on("offerOrAnswer",(function(e){console.log(e.type),"offer"===e.type&&n.setState(b({},n.state,{isCallee:!0,isCall:!0})),"answer"===e.type&&n.setState(b({},n.state,{isCaller:!0})),console.log("set remote description"),n.pc.setRemoteDescription(new RTCSessionDescription(e))})),n.socket.on("candidate",(function(e){console.log("add candidate v\xe0o m\xe1y local"),n.pc.addIceCandidate(new RTCIceCandidate(e))})),n.socket.on("stopCall",(function(e){console.log("H\u1ee7y k\u1ebft n\u1ed1i"),n.pc.close(),n.setState({isCall:!1,isClickedAnswer:!1,isCallee:null,camera:!0,mic:!1}),n.pc=new RTCPeerConnection(g),n.connectCall()})),n.pc=new RTCPeerConnection(g),n.connectCall()},n.sendToPeer=function(e,t){n.socket.emit(e,{socketID:n.socket.id,payload:t})},n.createOffer=function(){console.log("Offer"),n.setState(b({},n.state,{isCall:!0})),n.pc.createOffer({offerToReceiveVideo:1}).then((function(e){console.log("set local sdp v\xe0 g\u1eedi sdp"),n.pc.setLocalDescription(e),n.sendToPeer("offerOrAnswer",e)}))},n.createAnswer=function(){console.log("Answer"),n.setState(b({},n.state,{isClickedAnswer:!0})),n.pc.createAnswer({offerToReceiveVideo:1}).then((function(e){console.log("set local sdp v\xe0 g\u1eedi sdp"),n.pc.setLocalDescription(e),n.sendToPeer("offerOrAnswer",e)}))},n.cancelCall=function(){console.log("H\u1ee7y"),n.pc.close(),n.sendToPeer("stopCall",null),n.setState({isCall:!1,isClickedAnswer:!1,isCallee:null,camera:!0,mic:!1}),n.pc=new RTCPeerConnection(g),n.connectCall()},n.onOffCam=function(){n.stream.getVideoTracks()[0].enabled=!n.state.camera,n.setState(b({},n.state,{camera:!n.state.camera}))},n.onOffMic=function(){n.stream.getAudioTracks()[0].enabled=!n.state.mic,n.setState(b({},n.state,{mic:!n.state.mic}))},n.connectCall=function(){n.pc.onicecandidate=function(e){e.candidate&&(console.log("g\u1eedi candidate cho m\xe1y kh\xe1c"),n.sendToPeer("candidate",e.candidate))},n.pc.oniceconnectionstatechange=function(e){console.log("thi\u1ebft l\u1eadp th\xe0nh c\xf4ng",e)},n.pc.ontrack=function(e){console.log("nh\u1eadn d\xf2ng video"),n.remoteVideoref.current.srcObject=e.streams[0]};navigator.mediaDevices.getUserMedia({audio:!0,video:!0,options:{mirror:!0}}).then((function(e){n.stream=e,n.localVideoref.current.srcObject=e;var t=!0,o=!1,c=void 0;try{for(var a,r=e.getTracks()[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;n.pc.addTrack(s,e)}}catch(l){o=!0,c=l}finally{try{t||null==r.return||r.return()}finally{if(o)throw c}}})).catch((function(e){console.log("getUserMedia Error: ",e)}))},n.localVideoref=c.a.createRef(),n.remoteVideoref=c.a.createRef(),n.state={isCall:!1,isClickedAnswer:!1,isCallee:!1,camera:!0,mic:!1},n.socket=null,n.pc=null,n.stream=null,n}return Object(f.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.state,t=e.isCall,n=e.isCallee,o=e.isClickedAnswer;return c.a.createElement("div",{className:"container"},c.a.createElement("div",{className:"video-container"},c.a.createElement("div",{className:"videoBox"},c.a.createElement("video",{className:"videoLocal",ref:this.localVideoref,autoPlay:!0,muted:!0}),c.a.createElement("video",{className:"videoRemote",ref:this.remoteVideoref,autoPlay:!0}),c.a.createElement("div",{className:"button-group"},!t&&c.a.createElement("button",{className:"button-call btn-call",onClick:this.createOffer},"G\u1ecdi"),!o&&n&&c.a.createElement("button",{className:"button-call btn-answer",onClick:this.createAnswer},"Tr\u1ea3 l\u1eddi"),t&&c.a.createElement("button",{className:"button-call btn-cancel",onClick:this.cancelCall},"H\u1ee7y"),t&&c.a.createElement("button",{className:"button-call btn-cancel",onClick:this.onOffCam},"Cam"),t&&c.a.createElement("button",{className:"button-call btn-cancel",onClick:this.onOffMic},"Mic")))))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(v,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[34,1,2]]]);
//# sourceMappingURL=main.6b9d4429.chunk.js.map